---
title: "Teaching Lab Reviews"
---

<center><h2> Hover Over Points Below to Read Teaching Lab Professional Development Reviews </h2></center>

<br>
<br>

```{r echo = F, warning = F, message = F}
library(tidyverse)
library(ggiraph)
library(here)
sorted_teaching_df <- readr::read_rds(here::here("Data/tl_reviews.rds"))
theme_set(theme_minimal())

axis_colors <- c("#040404", "#324D56", "#346475", "#04ABEB")

col <- colorRampPalette(rev(axis_colors))

g <- ggplot(sorted_teaching_df, aes(
              x = fct_rev(pro_grouping), 
              y = `How Likely Are You To Recommend This Professional Learning To A Colleague Or Friend?`, 
              color = pro_grouping
  )) +
  scale_y_continuous(limits = c(0, 10), breaks = scales::breaks_pretty(n = 10)) +
  scale_color_manual(values = col(4)) +
  coord_flip() +
  labs(x = "", y = "Likeliness to Recommend to a Friend or Colleague", title = "Explore Teaching Lab Reviews") +
  theme(legend.position = "none",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, family = "Calibri", size = 30, face = "bold"),
        plot.subtitle = element_text(hjust = 0.5, family = "Calibri"),
        panel.grid = element_blank(),
        axis.title.y = element_text(family = "Calibri", size = 22),
        axis.title.x = element_text(family = "Calibri", size = 22),
        axis.text.x = element_text(color = "#324D56", family = "Calibri", 
                                   margin = unit(c(0, 0, -0.2, 0), "cm"),
                                   vjust = 10,
                                   size = 15),
        axis.text.y = element_text(color= axis_colors, family = "Calibri", size = 15),
        axis.ticks.x = element_line(size = 3, color = "#324D56", linetype = 2),
        axis.ticks.length.x = unit(0.2, "cm"))


# Graph with geoms applied for baselayer test
graph <- g + 
  geom_segment(
    aes(x = fct_rev(pro_grouping), xend = fct_rev(pro_grouping),
        y = mean_score, yend = grouped_means),
    show.legend = F,
    size = 0.8
  ) +
  geom_jitter(size = 3, height = 0.15) +
  stat_summary(fun = mean, geom = "point", size = 5) +
  geom_hline(aes(yintercept = mean_score), color = "gray70")

final_graph <- graph +
  geom_segment(
    aes(x = fct_rev(pro_grouping), xend = fct_rev(pro_grouping),
        y = mean_score, yend = grouped_means),
    show.legend = F,
    size = 0.8
  ) +
  ggiraph::geom_jitter_interactive(size = 3, aes(alpha = 0.8,
                            tooltip = paste(`District, Parish, Or Network`, 
                                            `Professional Training Session`,
                                            paste0("\"",
                                            `Overall, what went well in this professional learning?`,
                                            "\""
                                            ),
                                            sep = "\n")), 
              height = 0.15, width = 0.1) + # Height changes width here since coord_flip already happened
  # scale_alpha_manual(values = c(0.6, 0.2)) + # Manually change the alpha since they need to be set for different n
  stat_summary(fun = mean, geom = "point", size = 5) + # Add mean summary point
  geom_hline(aes(yintercept = mean_score), color = "gray70")

tooltip_css <- "font-family:'Calibri';color:white;"
html_plot <- girafe(ggobj = final_graph, fonts = list(sans = "Calibri"),
       options = list(
         opts_tooltip(offx = 15, offy = 15, use_cursor_pos = T, use_fill = T, css = tooltip_css),
         opts_sizing(rescale = T, width = 1),
         opts_hover_inv(css = "opacity:0.5;"),
         opts_toolbar(saveaspng = F)
         ),
       width_svg = 13, height_svg = 12
       ) %>%# Real size
  girafe_options(.,
                 htmlwidgets::sizingPolicy(padding = "5px",
                                           defaultWidth = "40%", defaultHeight = "40%"))

html_plot
```